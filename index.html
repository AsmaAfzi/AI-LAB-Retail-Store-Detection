<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Inventory Scanner - AI Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #0F172A;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .hidden {
            display: none !important;
        }

        /* Header */
        .header {
            border-bottom: 1px solid #334155;
            background: #1E293B;
            padding: 32px;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .logo-box {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .title {
            font-size: 32px;
            font-weight: 500;
            color: #F8FAFC;
            line-height: 1.5;
        }

        .subtitle {
            font-size: 14px;
            color: #94A3B8;
        }

        /* Navigation Tabs */
        .btn-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            color: #E2E8F0;
            background: #334155;
            border: 1px solid #475569;
            cursor: pointer;
        }

        .btn-tab:hover {
            background-color: #475569;
        }

        .btn-live {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            background: linear-gradient(to right, #11A8B8, #8E5CFF);
            color: white;
            cursor: pointer;
        }

        .btn-live:hover {
            opacity: 0.9;
        }

        /* Camera Grid */
        .camera-grid-container {
            padding: 32px;
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        @media (min-width: 768px) {
            .camera-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .camera-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .camera-card {
            position: relative;
            border-radius: 12px;
            border: 1px solid #334155;
            background: #1E293B;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
        }

        .camera-card:hover {
            transform: translateY(-2px);
            border-color: #11A8B8;
        }

        .camera-image-container {
            position: relative;
            aspect-ratio: 16/10;
            cursor: pointer;
        }

        .camera-image {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
        }

        .camera-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.8) 0%, rgba(15, 23, 42, 0.2) 50%, rgba(15, 23, 42, 0.4) 100%);
        }

        .live-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 999px;
            background-color: #DC3545;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: white;
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .live-text {
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .detection-badge {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 10;
            padding: 6px 12px;
            border-radius: 999px;
            background-color: #28A745;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .camera-icon-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .camera-image-container:hover .camera-icon-overlay {
            opacity: 1;
        }

        .camera-icon-circle {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background-color: rgba(17, 168, 184, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            z-index: 10;
        }

        .camera-name {
            font-size: 24px;
            font-weight: 500;
            color: #F8FAFC;
            margin-bottom: 4px;
        }

        .camera-location {
            font-size: 14px;
            color: #94A3B8;
        }

        .camera-placeholder {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom right, #1E293B, #0F172A);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-actions {
            padding: 16px;
            border-top: 1px solid #334155;
            display: flex;
            gap: 8px;
        }

        /* Buttons */
        button {
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-upload {
            flex: 1;
            padding: 10px 16px;
            border-radius: 8px;
            background: linear-gradient(135deg, #11A8B8 0%, #0891A1 100%);
            color: white;
            font-weight: 500;
        }

        .btn-upload:hover {
            background: linear-gradient(135deg, #0891A1 0%, #06737D 100%);
            transform: translateY(-1px);
        }

        .btn-inspect {
            flex: 1;
            padding: 10px 16px;
            border-radius: 8px;
            background: linear-gradient(135deg, #28A745 0%, #1E8E3E 100%);
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-inspect:hover {
            background: linear-gradient(135deg, #1E8E3E 0%, #15692F 100%);
            transform: translateY(-1px);
        }

        .btn-inspect:disabled {
            background: #475569;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .btn-back {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            color: #E2E8F0;
            background: transparent;
        }

        .btn-back:hover {
            background-color: #334155;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(4px);
            z-index: 20;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #334155;
            border-top-color: #11A8B8;
            border-right-color: #11A8B8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Inspect View */
        .inspect-view {
            min-height: 100vh;
            background: #FAF8F3;
        }

        .inspect-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: white;
            border-bottom: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
        }

        .inspect-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            height: 64px;
        }

        .inspect-logo-box {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .inspect-title {
            font-size: 24px;
            font-weight: 500;
            color: #1a1f3a;
        }

        .inspect-container {
            padding: 32px;
        }

        .inspect-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 24px;
            max-width: 1400px;
        }

        @media (max-width: 1024px) {
            .inspect-grid {
                grid-template-columns: 1fr;
            }
        }

        .inspect-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }

        .inspect-card-title {
            font-size: 20px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 20px;
        }

        .image-section {
            margin-top: 24px;
        }

        .section-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .image-container {
            border: 2px dashed #D1D5DB;
            border-radius: 12px;
            overflow: hidden;
            background: #F9FAFB;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 10px;
        }

        .image-placeholder {
            text-align: center;
            color: #9CA3AF;
            padding: 40px 20px;
        }

        .stats-grid {
            display: grid;
            gap: 16px;
        }

        .stat-card {
            background: #F9FAFB;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
        }

        .stat-label {
            font-size: 14px;
            color: #6B7280;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #111827;
            line-height: 1;
        }

        .stat-value.products {
            color: #28A745;
        }

        .stat-value.missing {
            color: #DC3545;
        }

        .status-badge {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 14px;
            border: 2px solid;
            margin-top: 24px;
        }

        .status-ok {
            background: #DCFCE7;
            color: #166534;
            border-color: #86EFAC;
        }

        .status-alert {
            background: #FEE2E2;
            color: #991B1B;
            border-color: #FCA5A5;
        }

        .alert-box {
            margin-top: 20px;
            padding: 16px;
            border-radius: 8px;
            background: #FEF2F2;
            border: 2px solid #FCA5A5;
        }

        .alert-content {
            display: flex;
            gap: 12px;
            align-items: start;
        }

        .alert-icon {
            flex-shrink: 0;
            color: #DC2626;
        }

        .alert-text {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #991B1B;
            margin-bottom: 4px;
        }

        .alert-message {
            font-size: 14px;
            color: #7F1D1D;
        }

        .detection-info {
            margin-top: 24px;
            padding: 20px;
            background: linear-gradient(to bottom right, #EFF6FF, #F3E8FF);
            border-radius: 12px;
            border: 1px solid #BFDBFE;
        }

        .info-title {
            font-weight: 600;
            color: #1F2937;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-text {
            font-size: 13px;
            color: #4B5563;
            line-height: 1.6;
        }

        /* Live & About Sections */
        .card {
            background: #1E293B;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #334155;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.3);
        }

        .live-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
        }

        @media (min-width: 1024px) {
            .live-grid {
                grid-template-columns: 1fr 2fr;
            }
        }

        .features-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 768px) {
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .gradient-box {
            background: linear-gradient(to bottom right, #1E293B, #334155);
            border: 1px solid #475569;
        }

        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 24px;
            background: white;
            border-radius: 8px;
            border: 2px solid #334155;
            margin-bottom: 24px;
        }

        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const API_URL = window.location.hostname === "localhost"
    ? "http://127.0.0.1:8000"
    : "https://your-app-name.onrender.com";
       
        const sampleImages = {
            'cam-1': '/images/testupload1.jpg',
            'cam-2': '/images/testupload2.jpg',
            'cam-3': '/images/testupload3.jpg',
            'cam-4': '/images/7.jpg',
            'cam-5': '/images/8.jpg',
            'cam-6': '/images/77.jpg',
            'cam-7': '/images/2.jpg',
            'cam-8': '/images/3.jpg',
            'cam-9': '/images/4.jpg',
        };

        let state = {
            currentView: 'grid',
            cameras: [
                { id: 'cam-1', name: 'Camera 1', location: 'Aisle 1', imageFile: null, previewUrl: sampleImages['cam-1'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-2', name: 'Camera 2', location: 'Aisle 2', imageFile: null, previewUrl: sampleImages['cam-2'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-3', name: 'Camera 3', location: 'Aisle 3', imageFile: null, previewUrl: sampleImages['cam-3'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-4', name: 'Camera 4', location: 'Aisle 4', imageFile: null, previewUrl: sampleImages['cam-4'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-5', name: 'Camera 5', location: 'Aisle 5', imageFile: null, previewUrl: sampleImages['cam-5'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-6', name: 'Camera 6', location: 'Aisle 6', imageFile: null, previewUrl: sampleImages['cam-6'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-7', name: 'Camera 7', location: 'Aisle 7', imageFile: null, previewUrl: sampleImages['cam-7'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-8', name: 'Camera 8', location: 'Aisle 8', imageFile: null, previewUrl: sampleImages['cam-8'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
                { id: 'cam-9', name: 'Camera 9', location: 'Aisle 9', imageFile: null, previewUrl: sampleImages['cam-9'], isLive: false, hasDetections: false, detectionCount: 0, detectionData: null },
            ],
            selectedCameraId: null,
            liveUploadedImage: null,
            liveAnnotatedImage: null,
            liveDetectionData: null,
            liveIsAnalyzing: false,
            testUploadedImage: null,
            testAnnotatedImage: null,
            testDetectionData: null,
            testIsAnalyzing: false
        };

        const icons = {
            arrowLeft: '<svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>',
            upload: '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>',
            eye: '<svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>',
            info: '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
            radio: '<svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="2"/><path stroke-linecap="round" stroke-linejoin="round" d="M16.24 7.76a6 6 0 010 8.49m-8.48-.01a6 6 0 010-8.49m11.31-2.82a10 10 0 010 14.14m-14.14 0a10 10 0 010-14.14"/></svg>',
            smartphone: '<svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>',
            target: '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
            zap: '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>',
            shield: '<svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>',
            dashboard: '<svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13h3v8H3zM9 3h3v18H9zM15 8h3v13h-3zM21 3h3v18h-3z" /></svg>'
        };

        function updateState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function updateCamera(cameraId, updates) {
            const cameras = state.cameras.map(cam =>
                cam.id === cameraId ? { ...cam, ...updates } : cam
            );
            updateState({ cameras });
        }

        function drawAnnotations(canvas, imageUrl, detections) {
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                detections.forEach(detection => {
                    const x = detection.x - detection.width / 2;
                    const y = detection.y - detection.height / 2;
                    const width = detection.width;
                    const height = detection.height;
                    
                    if (detection.class === 'product') {
                        ctx.strokeStyle = '#28A745';
                        ctx.fillStyle = 'rgba(40, 167, 69, 0.2)';
                    } else if (detection.class === 'missing') {
                        ctx.strokeStyle = '#DC3545';
                        ctx.fillStyle = 'rgba(220, 53, 69, 0.2)';
                    }
                    
                    ctx.lineWidth = 3;
                    ctx.fillRect(x, y, width, height);
                    ctx.strokeRect(x, y, width, height);
                    
                    const label = `${detection.class} ${(detection.confidence * 100).toFixed(1)}%`;
                    ctx.font = 'bold 14px Arial';
                    const textWidth = ctx.measureText(label).width;
                    
                    ctx.fillStyle = detection.class === 'product' ? '#28A745' : '#DC3545';
                    ctx.fillRect(x, y - 25, textWidth + 10, 25);
                    
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillText(label, x + 5, y - 7);
                });
            };
            
            img.src = imageUrl;
        }

        async function handleCameraFileSelect(cameraId, file) {
            if (!file) return;

            const previewUrl = URL.createObjectURL(file);
            updateCamera(cameraId, {
                imageFile: file,
                previewUrl,
                isLive: true
            });

            const analyzingEl = document.getElementById(`analyzing-${cameraId}`);
            if (analyzingEl) analyzingEl.classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/analyze-image`, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error('Failed to analyze image');
                }

                const data = await response.json();

                updateCamera(cameraId, {
                    imageFile: file,
                    previewUrl,
                    isLive: true,
                    hasDetections: true,
                    detectionCount: data.summary.total_products_detected + data.summary.total_missing_detected,
                    detectionData: data
                });
            } catch (error) {
                console.error('Error analyzing image:', error);
                alert('Failed to analyze image. Make sure your backend is running on http://127.0.0.1:8000');
                updateCamera(cameraId, {
                    isLive: false
                });
            } finally {
                if (analyzingEl) analyzingEl.classList.add('hidden');
            }
        }

        async function handleLiveFileSelect(file) {
            if (!file) return;

            const previewUrl = URL.createObjectURL(file);
            updateState({
                liveUploadedImage: previewUrl,
                liveAnnotatedImage: null,
                liveDetectionData: null,
                liveIsAnalyzing: true
            });

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/analyze-image`, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error('Failed to analyze image');
                }

                const data = await response.json();
                updateState({
                    liveAnnotatedImage: data.annotated_image || null,
                    liveDetectionData: data,
                    liveIsAnalyzing: false
                });
            } catch (error) {
                console.error('Error analyzing image:', error);
                alert('Failed to analyze image. Make sure your backend is running on http://127.0.0.1:8000');
                updateState({ liveIsAnalyzing: false });
            }
        }

        async function handleTestFileSelect(file) {
            if (!file) return;

            const previewUrl = URL.createObjectURL(file);
            updateState({
                testUploadedImage: previewUrl,
                testAnnotatedImage: null,
                testDetectionData: null,
                testIsAnalyzing: true
            });

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/analyze-image`, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error('Failed to analyze image');
                }

                const data = await response.json();
                updateState({
                    testAnnotatedImage: data.annotated_image || null,
                    testDetectionData: data,
                    testIsAnalyzing: false
                });
            } catch (error) {
                console.error('Error analyzing image:', error);
                alert('Failed to analyze image. Make sure your backend is running on http://127.0.0.1:8000');
                updateState({ testIsAnalyzing: false });
            }
        }

        function renderCameraGridView() {
    return `
        <div style="min-height: 100vh; background-color: #0F172A;">
            <!-- Thinner Header -->
            <div style="border-bottom: 1px solid #334155; background: #1E293B; padding: 16px 32px;">
                <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="logo-box">üì¶</div>
                        <div>
                            <h1 class="title">Retail Inventory Scanner</h1>
                            <p class="subtitle">AI-Powered CCTV Product Detection</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <button class="btn-tab" onclick="updateState({ currentView: 'about' })">
                            ${icons.info}
                            <span>About</span>
                        </button>
                        <button class="btn-tab" onclick="updateState({ currentView: 'dashboard' })">
                            ${icons.dashboard}
                            <span>Dashboard</span>
                        </button>
                        <button class="btn-live" onclick="updateState({ currentView: 'live' })">
                            ${icons.radio}
                            <span>Live</span>
                        </button>
                        <div style="padding: 6px 16px; border-radius: 8px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); color: white; font-weight: 700; letter-spacing: 0.05em; font-size: 12px;">
                            AI LAB
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rest remains exactly the same -->
            <div class="camera-grid-container">
                <div class="camera-grid">
                    ${state.cameras.map(camera => renderCameraCard(camera)).join('')}
                </div>
            </div>
        </div>
    `;
}

        function renderCameraCard(camera) {
            return `
                <div class="camera-card">
                    <div class="camera-image-container">
                        ${camera.previewUrl ? `
                            <img src="${camera.previewUrl}" alt="${camera.name}" class="camera-image">
                        ` : `
                            <div class="camera-placeholder">
                                No Footage
                            </div>
                        `}
                       
                        <div class="camera-overlay"></div>
                       
                        <div id="analyzing-${camera.id}" class="hidden">
                            <div class="loading-overlay">
                                <div class="spinner"></div>
                                <p style="margin-top: 8px; font-weight: 500; color: #E2E8F0;">Analyzing...</p>
                            </div>
                        </div>
                       
                        ${camera.isLive ? `
                            <div class="live-badge">
                                <div class="live-dot"></div>
                                <span class="live-text">LIVE</span>
                            </div>
                        ` : ''}
                       
                        ${camera.hasDetections ? `
                            <div class="detection-badge">${camera.detectionCount} Detected</div>
                        ` : ''}
                       
                        <div class="camera-info">
                            <h3 class="camera-name">${camera.name}</h3>
                            <p class="camera-location">${camera.location}</p>
                        </div>
                    </div>

                    <div class="camera-actions">
                        <button class="btn-inspect" style="flex: 1;" onclick="event.stopPropagation(); handleInspectClick('${camera.id}')" ${!camera.previewUrl ? 'disabled' : ''}>
                            ${icons.eye}
                            Inspect
                        </button>
                    </div>
                </div>
            `;
        }

        function renderInspectView() {
    const camera = state.cameras.find(c => c.id === state.selectedCameraId);
    if (!camera || !camera.detectionData) return '';

    const data = camera.detectionData;
    const products = data.summary.total_products_detected;
    const missing = data.summary.total_missing_detected;
    const total = data.details.length;
    const needsAction = missing > 0;

    setTimeout(() => {
        const canvas = document.getElementById('annotatedCanvas');
        if (canvas && camera.previewUrl && data.details) {
            drawAnnotations(canvas, camera.previewUrl, data.details);
        }
    }, 100);

    return `
        <div style="min-height: 100vh; background-color: #0F172A;">
            <!-- Header with Legend -->
            <div style="border-bottom: 1px solid #334155; background: #1E293B; padding: 16px 32px;">
                <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1600px; margin: 0 auto;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="btn-back" onclick="updateState({ currentView: 'grid', selectedCameraId: null })">
                            ${icons.arrowLeft}
                            <span>Back</span>
                        </button>
                        <div style="width: 32px; height: 32px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); display: flex; align-items: center; justify-content: center; font-size: 18px;">üì¶</div>
                        <div>
                            <h1 style="font-size: 20px; font-weight: 500; color: #F8FAFC; line-height: 1.2;">${camera.name} - AI Analysis</h1>
                            <p style="font-size: 12px; color: #94A3B8;">${camera.location}</p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: #28A745; border-radius: 4px;"></div>
                            <span style="color: #CBD5E1; font-size: 14px; font-weight: 500;">Product</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: #DC3545; border-radius: 4px;"></div>
                            <span style="color: #CBD5E1; font-size: 14px; font-weight: 500;">Missing</span>
                        </div>
                        <div style="padding: 4px 12px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); color: white; font-weight: 700; letter-spacing: 0.05em; font-size: 11px;">
                            AI LAB
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div style="max-width: 1600px; margin: 0 auto; padding: 24px;">
                <div style="display: grid; grid-template-columns: 280px 1fr 280px; gap: 20px;">
                    
                    <!-- Left Sidebar -->
                    <div>
                        <div class="card">
                            <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">üì∑ Original Image</h3>
                            <div style="border-radius: 8px; overflow: hidden; border: 2px solid #334155;">
                                <img src="${camera.previewUrl}" style="width: 100%; display: block;">
                            </div>
                        </div>

                        <div class="card" style="margin-top: 20px;">
                            <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">üìä Summary</h3>
                            <div style="background: #0F172A; padding: 12px; border-radius: 8px; border: 1px solid #334155; margin-bottom: 10px;">
                                <p style="font-size: 11px; color: #94A3B8; margin-bottom: 4px;">Total Detections</p>
                                <p style="font-size: 20px; font-weight: 700; color: #F8FAFC;">${total}</p>
                            </div>
                            <div style="background: rgba(40,167,69,0.1); padding: 12px; border-radius: 8px; border: 1px solid #28A745; margin-bottom: 10px;">
                                <p style="font-size: 11px; color: #94A3B8; margin-bottom: 4px;">Products Found</p>
                                <p style="font-size: 20px; font-weight: 700; color: #28A745;">${products}</p>
                            </div>
                            <div style="background: rgba(220,53,69,0.1); padding: 12px; border-radius: 8px; border: 1px solid #DC3545;">
                                <p style="font-size: 11px; color: #94A3B8; margin-bottom: 4px;">Missing Items</p>
                                <p style="font-size: 20px; font-weight: 700; color: #DC3545;">${missing}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Center - Annotated Image -->
                    <div>
                        <div class="card">
                            <h3 style="font-size: 16px; font-weight: 600; color: #F8FAFC; margin-bottom: 14px;">ü§ñ AI Detection Results</h3>
                            <div style="border-radius: 12px; overflow: hidden; border: 2px solid #11A8B8; background: #0F172A;">
                                <canvas id="annotatedCanvas" style="display: block; width: 100%; height: auto;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Right Sidebar -->
                    <div>
                        <div class="card">
                            <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">‚ö° Status</h3>
                            <div style="padding: 16px; border-radius: 8px; text-align: center; ${needsAction ? 'background: rgba(220,53,69,0.1); border: 2px solid #DC3545;' : 'background: rgba(40,167,69,0.1); border: 2px solid #28A745;'}">
                                <div style="font-size: 32px; margin-bottom: 6px;">${needsAction ? '‚ö†Ô∏è' : '‚úÖ'}</div>
                                <p style="font-size: 16px; font-weight: 600; color: ${needsAction ? '#DC3545' : '#28A745'};">
                                    ${needsAction ? 'Action Required' : 'All Good'}
                                </p>
                            </div>
                        </div>

                        ${needsAction ? `
                            <div class="card" style="margin-top: 20px; background: rgba(220,53,69,0.1); border: 2px solid #DC3545;">
                                <div style="display: flex; gap: 10px; align-items: start;">
                                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#DC3545" stroke-width="2" style="flex-shrink: 0;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    <div>
                                        <h4 style="font-weight: 600; color: #DC3545; margin-bottom: 6px; font-size: 13px;">Restock Alert</h4>
                                        <p style="font-size: 12px; color: #CBD5E1; line-height: 1.5;">
                                            ${missing} empty spot${missing > 1 ? 's' : ''} detected on shelf. Immediate restocking recommended.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Enhanced About / Analysis Summary -->
                        <div class="card" style="margin-top: 20px;">
                            <h3 style="font-size: 13px; font-weight: 600; color: #F8FAFC; margin-bottom: 10px;">üìã Analysis Summary</h3>
                            <p style="font-size: 13px; color: #CBD5E1; line-height: 1.6;">
                                The AI analyzed this shelf and detected <strong>${total} item${total !== 1 ? 's' : ''}</strong>:<br><br>
                                ‚Ä¢ <strong style="color: #28A745;">${products} product${products !== 1 ? 's' : ''} present</strong><br>
                                ‚Ä¢ <strong style="color: #DC3545;">${missing} empty/missing spot${missing !== 1 ? 's' : ''}</strong><br><br>
                                <strong>${needsAction ? '‚ö†Ô∏è Action required: Restock missing items.' : '‚úÖ No action needed: Shelf is fully stocked.'}</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

        function renderAboutSection() {
    return `
        <div style="min-height: 100vh; background-color: #0F172A;">
            <!-- Compact Header (thinner, same as Inspect/Live) -->
            <div style="border-bottom: 1px solid #334155; background: #1E293B; padding: 16px 32px;">
                <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="btn-back" onclick="updateState({ currentView: 'grid' })">
                            ${icons.arrowLeft}
                            <span>Back</span>
                        </button>
                        <div style="width: 32px; height: 32px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); display: flex; align-items: center; justify-content: center; font-size: 18px;">üì¶</div>
                        <div>
                            <h1 style="font-size: 20px; font-weight: 500; color: #F8FAFC; line-height: 1.2;">About This Project</h1>
                            <p style="font-size: 12px; color: #94A3B8;">AI-Powered Retail Inventory Management System</p>
                        </div>
                    </div>
                    <div style="padding: 4px 12px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); color: white; font-weight: 700; letter-spacing: 0.05em; font-size: 11px;">
                        AI LAB
                    </div>
                </div>
            </div>

            <!-- Content remains unchanged -->
            <div style="max-width: 1200px; margin: 0 auto; padding: 32px;">
                <div class="card" style="margin-bottom: 32px;">
                    <h2 style="font-size: 24px; font-weight: 500; color: #F8FAFC; margin-bottom: 16px;">Project Overview</h2>
                    <p style="font-size: 16px; color: #CBD5E1; line-height: 1.6; margin-bottom: 16px;">
                        The Retail Inventory Scanner is an advanced computer vision system designed to monitor and analyze retail shelf inventory in real-time. Using state-of-the-art AI detection algorithms, the system automatically identifies products and empty shelf spaces, providing instant alerts when restocking is needed.
                    </p>
                    <p style="font-size: 16px; color: #CBD5E1; line-height: 1.6;">
                        This solution helps retailers maintain optimal stock levels, reduce out-of-stock situations, and improve overall customer satisfaction.
                    </p>
                </div>

                <div class="features-grid">
                    <div class="card">
                        <div style="width: 48px; height: 48px; border-radius: 8px; background-color: rgba(40, 167, 69, 0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            ${icons.target}
                        </div>
                        <h3 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 8px;">Real-Time Detection</h3>
                        <p style="font-size: 14px; color: #94A3B8; line-height: 1.6;">
                            Continuously monitors shelf inventory with high accuracy, identifying products and gaps instantly.
                        </p>
                    </div>

                    <div class="card">
                        <div style="width: 48px; height: 48px; border-radius: 8px; background-color: rgba(17, 168, 184, 0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            ${icons.zap}
                        </div>
                        <h3 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 8px;">Instant Alerts</h3>
                        <p style="font-size: 14px; color: #94A3B8; line-height: 1.6;">
                            Automatically generates alerts when missing items are detected.
                        </p>
                    </div>

                    <div class="card">
                        <div style="width: 48px; height: 48px; border-radius: 8px; background-color: rgba(142, 92, 255, 0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            ${icons.shield}
                        </div>
                        <h3 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 8px;">Visual Annotations</h3>
                        <p style="font-size: 14px; color: #94A3B8; line-height: 1.6;">
                            Provides clear visual feedback with bounding boxes around detected items.
                        </p>
                    </div>

                    <div class="card">
                        <div style="width: 48px; height: 48px; border-radius: 8px; background-color: rgba(255, 140, 0, 0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            <svg width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#FF8C00" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                        <h3 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 8px;">Analytics Dashboard</h3>
                        <p style="font-size: 14px; color: #94A3B8; line-height: 1.6;">
                            Comprehensive dashboard showing detection statistics and insights.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `;
}

      function renderLiveSection() {
    return `
        <div style="min-height: 100vh; background-color: #0F172A;">
            <!-- Compact Header - thinner and consistent -->
            <div style="border-bottom: 1px solid #334155; background: #1E293B; padding: 16px 32px;">
                <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button class="btn-back" onclick="updateState({ currentView: 'grid' })">
                            ${icons.arrowLeft}
                            <span>Back</span>
                        </button>
                        <div style="width: 32px; height: 32px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); display: flex; align-items: center; justify-content: center;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background-color: white; animation: pulse 2s infinite;"></div>
                        </div>
                        <div>
                            <h1 style="font-size: 20px; font-weight: 500; color: #F8FAFC; line-height: 1.2;">Live Testing Mode</h1>
                            <p style="font-size: 12px; color: #94A3B8;">Upload images from your phone for real-time AI analysis</p>
                        </div>
                    </div>
                    <div style="padding: 4px 12px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); color: white; font-weight: 700; letter-spacing: 0.05em; font-size: 11px;">
                        AI LAB
                    </div>
                </div>
            </div>

            <!-- Content remains exactly the same -->
            <div style="max-width: 1400px; margin: 0 auto; padding: 32px;">
                <div class="live-grid">
                    <div>
                        <div class="card" style="position: sticky; top: 24px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                                ${icons.smartphone}
                                <h2 style="font-size: 20px; font-weight: 500; color: #F8FAFC;">Scan with Phone</h2>
                            </div>
                            <p style="font-size: 14px; color: #94A3B8; margin-bottom: 24px;">
                                Scan this QR code with your phone to access this page and upload images directly from your mobile device.
                            </p>

                            <div style="display: flex; justify-content: center; align-items: center; padding: 24px; background: white; border-radius: 8px; border: 2px solid #334155; margin-bottom: 24px;">
                                <img src="/images/qrcode.png" alt="QR Code for Mobile Access" style="width: 200px; height: 200px;">
                            </div>

                            <div class="gradient-box" style="border-radius: 8px; padding: 16px;">
                                <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 8px;">How to use:</h3>
                                <ol style="font-size: 14px; color: #CBD5E1; padding-left: 20px;">
                                    <li>1. Open camera on your phone</li>
                                    <li>2. Scan the QR code above</li>
                                    <li>3. Upload shelf images</li>
                                    <li>4. Get instant AI analysis</li>
                                </ol>
                            </div>

                            <div style="margin-top: 24px;">
                                <input type="file" id="live-file-input" accept="image/*" capture="environment" onchange="handleLiveFileChange(event)">
                                <button class="btn-live" style="width: 100%; padding: 12px; justify-content: center;" onclick="document.getElementById('live-file-input').click()">
                                    ${icons.upload}
                                    Upload Image
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="card">
                            <div style="padding: 24px; border-bottom: 1px solid #334155;">
                                <h2 style="font-size: 20px; font-weight: 500; color: #F8FAFC;">Live AI Detection</h2>
                                <p style="font-size: 14px; color: #94A3B8; margin-top: 4px;">
                                    Upload a shelf image to see real-time product and gap detection
                                </p>
                            </div>

                            <div style="padding: 32px;">
                                <!-- Your existing live preview content (no changes here) -->
                                ${!state.liveUploadedImage && !state.liveIsAnalyzing ? `
                                    <div style="aspect-ratio: 16/10; border: 2px dashed #475569; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #1E293B;">
                                        <div style="width: 64px; height: 64px; border-radius: 50%; background: rgba(17,168,184,0.1); display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                            ${icons.upload}
                                        </div>
                                        <h3 style="font-size: 18px; color: #F8FAFC; margin-bottom: 8px;">No image uploaded yet</h3>
                                        <p style="color: #94A3B8; text-align: center;">Click upload or scan QR code with phone</p>
                                    </div>
                                ` : ''}

                                ${state.liveIsAnalyzing ? `
                                    <div style="aspect-ratio: 16/10; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #1E293B;">
                                        <div class="spinner" style="margin-bottom: 16px;"></div>
                                        <p style="color: #CBD5E1;">Analyzing image with AI...</p>
                                    </div>
                                ` : ''}

                                ${state.liveUploadedImage && !state.liveIsAnalyzing ? `
                                    <div style="display: flex; flex-direction: column; gap: 32px;">

                                        ${state.liveDetectionData ? `
                                        <div>
                                            <h3 style="font-size: 18px; color: #F8FAFC; margin-bottom: 16px; text-align: center;">AI Detection Results</h3>
                                            <div style="border-radius: 16px; overflow: hidden; border: 3px solid #11A8B8; background: #0F172A; box-shadow: 0 4px 20px rgba(17,168,184,0.2);">
                                                <canvas id="liveAnnotatedCanvas" style="display: block; width: 100%; height: auto;"></canvas>
                                            </div>

                                            <div style="margin-top: 16px; display: flex; justify-content: center; gap: 20px;">
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <div style="width: 16px; height: 16px; background: #28A745; border-radius: 4px;"></div>
                                                    <span style="color: #CBD5E1; font-size: 14px;">Product Detected</span>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <div style="width: 16px; height: 16px; background: #DC3545; border-radius: 4px;"></div>
                                                    <span style="color: #CBD5E1; font-size: 14px;">Missing / Empty Spot</span>
                                                </div>
                                            </div>
                                        </div>
                                        ` : `
                                        <div style="aspect-ratio: 16/10; border: 2px dashed #475569; border-radius: 16px; display: flex; align-items: center; justify-content: center; background: #1E293B;">
                                            <p style="color: #94A3B8;">Analysis failed or no detections found</p>
                                        </div>
                                        `}

                                        ${state.liveDetectionData ? `
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                            <div style="background: #1E293B; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #334155;">
                                                <p style="font-size: 13px; color: #94A3B8;">Total Detections</p>
                                                <p style="font-size: 32px; font-weight: 700; color: #F8FAFC; margin-top: 8px;">${state.liveDetectionData.details.length}</p>
                                            </div>
                                            <div style="background: rgba(40,167,69,0.15); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #28A745;">
                                                <p style="font-size: 13px; color: #94A3B8;">Products Found</p>
                                                <p style="font-size: 32px; font-weight: 700; color: #28A745; margin-top: 8px;">${state.liveDetectionData.summary.total_products_detected}</p>
                                            </div>
                                            <div style="background: rgba(220,53,69,0.15); padding: 20px; border-radius: 12px; text-align: center; border: 2px solid #DC3545;">
                                                <p style="font-size: 13px; color: #94A3B8;">Missing Items</p>
                                                <p style="font-size: 32px; font-weight: 700; color: #DC3545; margin-top: 8px;">${state.liveDetectionData.summary.total_missing_detected}</p>
                                            </div>
                                        </div>
                                        ` : ''}

                                        <div style="text-align: center;">
                                            <button style="padding: 14px 36px; border: 2px solid #11A8B8; background: transparent; color: #11A8B8; border-radius: 12px; font-size: 16px; font-weight: 500; cursor: pointer;" onclick="document.getElementById('live-file-input').click()">
                                                Upload Another Image
                                            </button>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}
        
function renderDashboardView() {
            // Aggregate data (unchanged)
            let totalProducts = 0;
            let totalMissing = 0;
            const aisleProducts = [];
            const aisleMissing = [];
            const aisleLabels = [];
            state.cameras.forEach(camera => {
                if (camera.detectionData) {
                    totalProducts += camera.detectionData.summary.total_products_detected;
                    totalMissing += camera.detectionData.summary.total_missing_detected;
                    aisleLabels.push(camera.location);
                    aisleProducts.push(camera.detectionData.summary.total_products_detected);
                    aisleMissing.push(camera.detectionData.summary.total_missing_detected);
                }
            });

            setTimeout(() => {
                // Futuristic Doughnut Chart
                const pieCtx = document.getElementById('overallPie');
                if (pieCtx) {
                    new Chart(pieCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Products Detected', 'Missing Items'],
                            datasets: [{
                                data: [totalProducts, totalMissing],
                                backgroundColor: [
                                    'rgba(17, 168, 184, 0.8)',
                                    'rgba(142, 92, 255, 0.8)'
                                ],
                                borderColor: ['#11A8B8', '#8E5CFF'],
                                borderWidth: 3,
                                hoverBackgroundColor: [
                                    'rgba(17, 168, 184, 1)',
                                    'rgba(142, 92, 255, 1)'
                                ],
                                cutout: '70%'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#F8FAFC',
                                        font: { size: 14 },
                                        padding: 20,
                                        usePointStyle: true
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                    titleColor: '#11A8B8',
                                    bodyColor: '#F8FAFC',
                                    borderColor: '#8E5CFF',
                                    borderWidth: 1
                                }
                            },
                            animation: {
                                animateRotate: true,
                                duration: 2000
                            }
                        }
                    });
                }

                // Futuristic Bar Chart
                const barCtx = document.getElementById('aisleBar');
                if (barCtx) {
                    new Chart(barCtx, {
                        type: 'bar',
                        data: {
                            labels: aisleLabels,
                            datasets: [
                                {
                                    label: 'Products',
                                    data: aisleProducts,
                                    backgroundColor: 'rgba(17, 168, 184, 0.6)',
                                    borderColor: '#11A8B8',
                                    borderWidth: 2,
                                    borderRadius: 8,
                                    hoverBackgroundColor: 'rgba(17, 168, 184, 0.9)'
                                },
                                {
                                    label: 'Missing',
                                    data: aisleMissing,
                                    backgroundColor: 'rgba(142, 92, 255, 0.6)',
                                    borderColor: '#8E5CFF',
                                    borderWidth: 2,
                                    borderRadius: 8,
                                    hoverBackgroundColor: 'rgba(142, 92, 255, 0.9)'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    grid: { display: false },
                                    ticks: { color: '#94A3B8' }
                                },
                                y: {
                                    grid: { color: 'rgba(51, 65, 85, 0.3)' },
                                    ticks: { color: '#94A3B8', beginAtZero: true }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: { color: '#F8FAFC', font: { size: 14 } }
                                }
                            },
                            animation: { duration: 1500 }
                        }
                    });
                }
            }, 100);

            return `
                <div style="min-height: 100vh; background-color: #0F172A;">
                    <!-- Header (unchanged) -->
                    <div style="border-bottom: 1px solid #334155; background: #1E293B; padding: 16px 32px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; max-width: 1400px; margin: 0 auto;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <button class="btn-back" onclick="updateState({ currentView: 'grid' })">
                                    ${icons.arrowLeft}
                                    <span>Back</span>
                                </button>
                                <div style="width: 32px; height: 32px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); display: flex; align-items: center; justify-content: center; font-size: 18px;">üìä</div>
                                <div>
                                    <h1 style="font-size: 20px; font-weight: 500; color: #F8FAFC; line-height: 1.2;">Inventory Dashboard</h1>
                                    <p style="font-size: 12px; color: #94A3B8;">Real-time AI insights across all aisles</p>
                                </div>
                            </div>
                            <div style="padding: 4px 12px; border-radius: 6px; background: linear-gradient(135deg, #11A8B8 0%, #8E5CFF 100%); color: white; font-weight: 700; letter-spacing: 0.05em; font-size: 11px;">
                                AI LAB
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Content with Futuristic Glassmorphism -->
                    <div style="max-width: 1400px; margin: 0 auto; padding: 32px;">
                        <!-- Stat Cards - Translucent with glow -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 32px;">
                            <div class="card" style="background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(17, 168, 184, 0.3); box-shadow: 0 8px 32px rgba(17, 168, 184, 0.1);">
                                <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">Total Products</h3>
                                <p style="font-size: 32px; font-weight: 700; color: #11A8B8;">${totalProducts}</p>
                            </div>
                            <div class="card" style="background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border: 1px solid rgba(142, 92, 255, 0.3); box-shadow: 0 8px 32px rgba(142, 92, 255, 0.1);">
                                <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">Total Missing</h3>
                                <p style="font-size: 32px; font-weight: 700; color: #8E5CFF;">${totalMissing}</p>
                            </div>
                            <div class="card" style="background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(10px); border: 1px solid #475569;">
                                <h3 style="font-size: 14px; font-weight: 600; color: #F8FAFC; margin-bottom: 12px;">Aisles Monitored</h3>
                                <p style="font-size: 32px; font-weight: 700; color: #F8FAFC;">${state.cameras.length}</p>
                            </div>
                        </div>

                        <!-- Charts - Translucent cards with glow -->
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 32px;">
                            <div class="card" style="background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(17, 168, 184, 0.4); box-shadow: 0 10px 40px rgba(17, 168, 184, 0.15);">
                                <h2 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 16px;">Overall Distribution</h2>
                                <canvas id="overallPie" style="max-height: 400px;"></canvas>
                            </div>
                            <div class="card" style="background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(142, 92, 255, 0.4); box-shadow: 0 10px 40px rgba(142, 92, 255, 0.15);">
                                <h2 style="font-size: 18px; font-weight: 500; color: #F8FAFC; margin-bottom: 16px;">Per Aisle Breakdown</h2>
                                <canvas id="aisleBar" style="max-height: 400px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function handleInspectClick(cameraId) {
            const camera = state.cameras.find(c => c.id === cameraId);
            if (!camera.previewUrl) return;

            if (camera.hasDetections) {
                updateState({ currentView: 'inspect', selectedCameraId: cameraId });
                return;
            }

            // Analyze first if not already done
            const analyzingEl = document.getElementById(`analyzing-${cameraId}`);
            if (analyzingEl) analyzingEl.classList.remove('hidden');

            try {
                const response = await fetch(camera.previewUrl);
                const blob = await response.blob();
                const file = new File([blob], `${camera.id}.jpg`, { type: blob.type });
                await handleCameraFileSelect(cameraId, file);
                updateState({ currentView: 'inspect', selectedCameraId: cameraId });
            } catch (error) {
                console.error(error);
                alert('Failed to analyze');
            } finally {
                if (analyzingEl) analyzingEl.classList.add('hidden');
            }
        }

        function handleLiveFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                handleLiveFileSelect(file);
            }
        }

        function handleTestFileChange(event) {
            const file = event.target.files[0];
            if (file) {
                handleTestFileSelect(file);
            }
        }

        function render() {
            const app = document.getElementById('app');
            let content = '';

            switch (state.currentView) {
                case 'grid':
                    content = renderCameraGridView();
                    break;
                case 'inspect':
                    content = renderInspectView();
                    break;
                case 'about':
                    content = renderAboutSection();
                    break;
                case 'live':
                    content = renderLiveSection();
                    // Generate QR code after rendering
                    setTimeout(() => {
    const canvas = document.getElementById('liveAnnotatedCanvas');
    if (canvas && state.liveUploadedImage && state.liveDetectionData?.details) {
        drawAnnotations(canvas, state.liveUploadedImage, state.liveDetectionData.details);
    }
}, 100);
                    break;
                case 'dashboard':
                    content = renderDashboardView();
                    break;
            }

            app.innerHTML = content;
        }

        render();
    </script>
</body>
</html>
